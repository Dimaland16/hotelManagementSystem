<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title th:text="${mode == 'edit' ? 'Редактировать бронь' : 'Добавить бронь'}">Форма</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Optional: Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

</head>
<body class="bg-light">

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white text-center">
          <h3 class="mb-0" th:text="${mode == 'edit' ? 'Редактировать бронь' : 'Добавить бронь'}">Форма</h3>
        </div>
        <div class="card-body p-4">

          <form th:object="${bookingDto}"
                th:action="${mode == 'edit' ? '/bookings/' + bookingDto.id : '/bookings'}"
                method="post" class="needs-validation" novalidate>

            <!-- ID только если редактируем -->
            <div th:if="${mode == 'edit'}">
              <input type="hidden" th:field="*{id}" />
            </div>

            <!-- Дата заезда -->
            <div class="mb-3">
              <label for="checkInDate" class="form-label">Дата заезда</label>
              <input type="date"
                     class="form-control"
                     id="checkInDate"
                     th:field="*{checkInDate}"
                     required />
            </div>

            <!-- Дата выезда -->
            <div class="mb-3">
              <label for="checkOutDate" class="form-label">Дата выезда</label>
              <input type="date"
                     class="form-control"
                     id="checkOutDate"
                     th:field="*{checkOutDate}"
                     required />
            </div>

            <!-- Гость -->
            <div class="mb-3">
              <label for="guest" class="form-label">Гость</label>
              <select id="guest" class="form-select" th:field="*{guestId}" required>
                <option th:each="user : ${users}"
                        th:value="${user.id}"
                        th:text="${user.lastName}"
                        th:selected="${user.id} == ${bookingDto.guestId}">
                  [Гость]
                </option>
              </select>
            </div>

            <!-- Номер -->
            <div class="mb-3">
              <label for="room" class="form-label">Номер</label>
              <select id="room" class="form-select" th:field="*{roomId}" required>
                <option th:each="room : ${rooms}"
                        th:value="${room.id}"
                        th:text="${room.roomNumber + ' (' + room.roomTypeName + ')'}"
                        th:selected="${room.id} == ${bookingDto.roomId}">
                  [Номер]
                </option>
              </select>
            </div>

            <!-- Статус -->
            <div class="mb-3">
              <label for="status" class="form-label">Статус</label>
              <select id="status" class="form-select" th:field="*{status}" required>
                <option value="Ожидание">Ожидание</option>
                <option value="Подтверждена">Подтверждена</option>
                <option value="Завершена">Завершена</option>
                <option value="Отмена">Отмена</option>
              </select>
            </div>

            <!-- Оплачено -->
            <div class="mb-3">
              <label for="paidAmount" class="form-label">Оплачено</label>
              <input type="number" step="0.01"
                     class="form-control"
                     id="paidAmount"
                     th:field="*{paidAmount}"
                     required />
            </div>

            <!-- Кнопки -->
            <div class="d-flex justify-content-between mt-4">
              <a th:href="@{/bookings}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left-circle"></i> Отмена
              </a>
              <button type="submit" class="btn btn-success">
                <i class="bi bi-save"></i>
                <span th:text="${mode == 'edit' ? 'Сохранить изменения' : 'Добавить бронь'}">Сохранить</span>
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS + Validation -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Валидация формы -->
<script>
  (function () {
    'use strict'

    const forms = document.querySelectorAll('.needs-validation')
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }

        form.classList.add('was-validated')
      }, false)
    })
  })()
</script>

</body>
</html>